{% extends 'front.html.twig' %}

{% block _main %}
    <div class="ps-page--product">
        <div class="ps-container">
            <div class="ps-page__container">
                <div class="ps-page__left">
                    <div class="ps-product--detail ps-product--fullwidth">
                        <div class="ps-product__header">
                            <div class="ps-product__thumbnail" data-vertical="true">
                                <figure>
                                    <div class="ps-wrapper">
                                        <div class="ps-product__gallery" data-arrow="true">
                                            {% if producto.foto %}
                                                <div class="item">
                                                    <a href="{{ producto.foto | file_upload_webpath }}">
                                                        <img src="{{ producto.foto | file_upload_webpath }}" alt="">
                                                    </a>
                                                </div>
                                            {% endif %}
                                            {% for imagen in producto.imagenes %}
                                                <div class="item">
                                                    <a href="{{ imagen | file_upload_webpath }}">
                                                        <img src="{{ imagen | file_upload_webpath }}" alt="">
                                                    </a>
                                                </div>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </figure>
                                <br/>
                                <div class="ps-product__variants" data-item="4" data-md="4" data-sm="4" data-arrow="false">
                                    {% if producto.foto %}
                                        <div class="item">
                                            <div class="item"><img src="{{ producto.foto | file_upload_webpath }}" alt=""></div>
                                        </div>
                                    {% endif %}
                                    {% for imagen in producto.imagenes %}
                                        <div class="item"><img src="{{ imagen | file_upload_webpath }}" alt=""></div>
                                    {% endfor %}
                                </div>
                            </div>
                            <div class="ps-product__info">
                                <h1>{{ producto.nombre }}</h1>
                                <!--MARCA-->
                                <div class="ps-product__meta">
                                    <p>Marca:<a href="#">
                                            {{ producto.marca }}
                                        </a></p>
                                    <!--CATEGORIA-->
                                    <div class="ps-product__specification">
                                        <p class="categories"><strong> Categoria:</strong>
                                            <a href="#">{{ producto.categoria }}</a>
                                        </p>
                                    </div>
                                    <div class="ps-product__specification">
                                        <p> {{ producto.stock }} unidades disponibles
                                        </p>
                                    </div>
                                    <!--VALORACION-->
                                    {#                                    <div class="ps-product__rating">#}
                                    {#                                        <select class="ps-rating" data-read-only="true">#}
                                    {#                                            <option value="1">1</option>#}
                                    {#                                            <option value="1">2</option>#}
                                    {#                                            <option value="1">3</option>#}
                                    {#                                            <option value="1">4</option>#}
                                    {#                                            <option value="1">5</option>#}
                                    {#                                        </select><span>(1 review)</span>#}
                                    {#                                    </div>#}
                                </div>
                                <h4 class="ps-product__price">S/ {{ producto.precio }}</h4>
                                <div class="ps-product__desc">
                                    {{ producto.descripcion }}
                                </div>
                                <div class="ps-product__variations">
                                    <figure>
                                        <figcaption>Color</figcaption>
                                        <div class="ps-variant ps-variant--color color--1"><span class="ps-variant__tooltip">Black</span></div>
                                        <div class="ps-variant ps-variant--color color--2"><span class="ps-variant__tooltip"> Gray</span></div>
                                    </figure>
                                </div>
                                <div class="ps-product__shopping">
                                    <figure>
                                        <figcaption>Quantity</figcaption>
                                        <div class="form-group--number">
                                            <button id="quantityIncrementButton" class="up"><i class="fa fa-plus"></i></button>
                                            <button id="quantityDecrementButton" class="down"><i class="fa fa-minus"></i></button>
                                            <input id="quantityInput" class="form-control" type="text" value="1">
                                        </div>
                                    </figure>
                                    <a id="addCartButton" class="ps-btn ps-btn--black" href="#">
                                        Add to cart
                                    </a>
                                    <a class="ps-btn" href="#">Buy Now</a>
                                    <div class="ps-product__actions"><a href="#"><i class="icon-heart"></i></a><a href="#"><i class="icon-chart-bars"></i></a></div>
                                </div>
                                <!--CATEGORIAS-->
                                <div class="ps-product__specification">
                                    <p class="categories"><strong> Categories:</strong>
                                        <a href="#">{{  producto.categoria }}</a>
                                    </p>
                                </div>
                                <div class="ps-product__sharing"><a class="facebook" href="#"><i class="fa fa-facebook"></i></a><a class="twitter" href="#"><i class="fa fa-twitter"></i></a><a class="google" href="#"><i class="fa fa-google-plus"></i></a><a class="linkedin" href="#"><i class="fa fa-linkedin"></i></a><a class="instagram" href="#"><i class="fa fa-instagram"></i></a></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ps-page__right">
                    <aside class="widget widget_product widget_features">
                        <p><i class="icon-network"></i> Envío a nivel Mundial. </p>
                        <p><i class="icon-3d-rotate"></i> Devolución gratuita de 7 días si es elegible, así de fácil </p>
                        <p><i class="icon-receipt"></i> El proveedor entrega facturas por este producto. </p>
                        <p><i class="icon-credit-card"></i> Pague en línea o al recibir mercancías. </p>
                    </aside>
                    <aside class="widget widget_sell-on-site">
                        <p><i class="icon-store"></i> ¿Vender en Martfury?<a href="#"> Regístrate ahora! </a></p>
                    </aside>
                    {#                    <aside class="widget widget_ads">#}
                    {#                        <a href="#">#}
                    {#                            <img src="{{ asset(_theme~'img/ads/product-ads.png') }}" alt="">#}
                    {#                        </a>#}
                    {#                    </aside>#}
                    {#                    <aside class="widget widget_same-brand">#}
                    {#                        <h3>MISMA CATEGORIA</h3>#}
                    {#                        <div class="widget__content">#}
                    {#                            <div class="ps-product">#}
                    {#                                <div class="ps-product__thumbnail"><a href="#"><img src="{{ asset(_theme~'img/products/shop/5.jpg') }}" alt="" /></a>#}
                    {#                                    <div class="ps-product__badge">-37%</div>#}
                    {#                                    <ul class="ps-product__actions">#}
                    {#                                        <li><a href="#" data-toggle="tooltip" data-placement="top" title="Add To Cart"><i class="icon-bag2"></i></a></li>#}
                    {#                                        <li><a href="#" data-placement="top" title="Quick View" data-toggle="modal" data-target="#product-quickview"><i class="icon-eye"></i></a></li>#}
                    {#                                        <li><a href="#" data-toggle="tooltip" data-placement="top" title="Add to Whishlist"><i class="icon-heart"></i></a></li>#}
                    {#                                        <li><a href="#" data-toggle="tooltip" data-placement="top" title="Compare"><i class="icon-chart-bars"></i></a></li>#}
                    {#                                    </ul>#}
                    {#                                </div>#}
                    {#                                <div class="ps-product__container"><a class="ps-product__vendor" href="#">Robert's Store</a>#}
                    {#                                    <div class="ps-product__content"><a class="ps-product__title" href="#">Grand Slam Indoor Of Show Jumping Novel</a>#}
                    {#                                        <p class="ps-product__price sale">$32.99 <del>$41.00 </del></p>#}
                    {#                                    </div>#}
                    {#                                    <div class="ps-product__content hover"><a class="ps-product__title" href="#">Grand Slam Indoor Of Show Jumping Novel</a>#}
                    {#                                        <p class="ps-product__price sale">$32.99 <del>$41.00 </del></p>#}
                    {#                                    </div>#}
                    {#                                </div>#}
                    {#                            </div>#}
                    {#                        </div>#}
                    {#                    </aside>#}
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block stylesheets %}
    <link href="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css" rel="stylesheet" type="text/css" />
{% endblock %}

{% block javascript %}
<script src="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
<script src="{{ asset('js/notify.js') }}" type="text/javascript"></script>
    <script>
        let $quantityInput = $('#quantityInput');
        let $addCartButton = $('#addCartButton');

        function validarStockAjax()
        {
            $.ajax({
                    type: 'post',
                    url: '{{ path("app_producto_validar_stock") }}',
                    data: {
                        'producto-id': {{ producto.id }},
                        'cantidad': $quantityInput.val()
                    },
                    success: function (result) {
                        if (!result.status) {
                            Notify.danger('El stock es maximo '+result.data)
                            $quantityInput.val(result.data);
                        }
                    }
                });
        }

        jQuery(document).ready(function() {
            $(document).on('click', '#addCartButton', function () {
                validarStockAjax()
            });

            $(document).on('change', '#quantityInput', function () {
                validarStockAjax()
            });

            $(document).on('click', '#quantityIncrementButton', function () {
                let cantidad = parseInt($quantityInput.val()) + 1;
                $quantityInput.val(cantidad);
                validarStockAjax()
            });

            $(document).on('click', '#quantityDecrementButton', function () {
                let cantidad = parseInt($quantityInput.val()) - 1;
                if (cantidad > 0) {
                    $quantityInput.val(cantidad);
                    validarStockAjax()
                }
            });
        });
    </script>
{% endblock %}